import{u as U,r as p,j as e,F as Y,i as G,A as J,L as Q,a as X,b as Z}from"./index-olMwwqT3.js";import{c as ee,u as te,a as se,b as ae,d as re,e as oe,F as ne,T as ie,f,g,h as ce,D as le,i as me,S as de,M as ue,t as pe}from"./constants-0HZD1wuV.js";import{u as fe,D as ge}from"./divisions-dropdown-_sKVYw-5.js";const he=["contact_name","email","phone","date"],Se=ee(he),Te=()=>{var T,$,F;const{userName:h}=U();console.log(h);const{control:d,formState:{errors:i},handleSubmit:E,reset:v,watch:u}=te({resolver:pe(Se),mode:"onSubmit",defaultValues:{contact_name:h}}),{setDepartment:A,setDivision:R,setType:V,setDateRequest:C}=se(),{resetDateTime:L,time:S,startDate:c}=ae(),{filter:a,clearFilter:k}=fe(),{filter:r,clearFilter:q}=re(),[z,x]=p.useState(!1),[j,o]=p.useState(""),I=u("contact_name"),N=u("email"),D=u("phone"),O=()=>!I||!N||!D?(o("Пожалуйста, заполните все обязательные поля."),!1):a!=null&&a.id?r!=null&&r.id?!S||!c?(o("Пожалуйста, выберите дату и время."),!1):!0:(o("Пожалуйста, выберите тип заявки."),!1):(o("Пожалуйста, выберите ваше подразделение."),!1);p.useEffect(()=>{if(a!=null&&a.id&&(r!=null&&r.id)&&c){const t=new Date(c).toISOString().split("T")[0];A(10),R(a.id),V(r.id),C(t)}},[a,r,c]);const{isLoading:b,mutate:P}=oe({mutationKey:["createRequest"],mutationFn:async s=>await X.post(`${Z}/api/requests/`,s,{headers:{"Content-Type":"application/json",Authorization:`${localStorage.getItem("authToken")}`}})}),W=s=>{if(!O())return;const[t,H]=S.split(":").map(Number),n=new Date(c);n.setHours(t,H,0,0);const B=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}T${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`,l={...s,department:10,division:a.id,type:r.id,date:B},m=D.replace(/\D/g,"");if(l.phone=m.startsWith("7")?"8"+m.slice(1):(m.startsWith("8"),m),l.phone.length<8||l.phone.length>14){o("Телефон должен содержать от 8 до 14 цифр.");return}console.log("Отправляемые данные:",l),P(l,{onSuccess:()=>{x(!0),setTimeout(()=>x(!1),3e3),L(),k(),q(),v({contact_name:"",phone:"",email:"",date:""}),o("")},onError:K=>{var w,M,y;const _=(y=(M=(w=K.response)==null?void 0:w.data)==null?void 0:M.non_field_errors)==null?void 0:y[0];o(_?`Произошла ошибка при отправке. ${_}`:"Произошла ошибка при отправке, попробуйте ещё раз.")}})};return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{submitFn:E(W),children:[e.jsx(ge,{}),e.jsx(ie,{}),e.jsx(f,{field:"contact_name",error:((T=i.contact_name)==null?void 0:T.message)||"",control:d,render:({field:s})=>{var t;return e.jsx(g,{fieldValue:"contact_name",error:((t=i.contact_name)==null?void 0:t.message)||"",field:s})}}),e.jsxs(Y,{$direction:G?"column":"row",$gap:15,$justify:"space-between",$align:"flex-start",children:[e.jsx(f,{field:"email",error:(($=i.email)==null?void 0:$.message)||"",control:d,render:({field:s})=>{var t;return e.jsx(g,{fieldValue:"email",error:((t=i.email)==null?void 0:t.message)||"",field:s})}}),e.jsx(f,{field:"phone",error:((F=i.phone)==null?void 0:F.message)||"",control:d,render:({field:s})=>{var t;return e.jsx(g,{fieldValue:"phone",error:((t=i.phone)==null?void 0:t.message)||"",field:s})}})]}),e.jsxs(ce,{children:[e.jsx(le,{}),e.jsx(me,{})]}),e.jsx(J,{children:e.jsxs("label",{children:['Нажимая кнопку "Отправить", Вы даёте свое  ',e.jsx(Q,{href:"/public/Согласие-на-обработку.pdf",download:!0,children:"Согласие на обработку персональных данных"}),' в соответствии с Федеральным Законом №152-ФЗ от 27.07.2006 "О персональных данных".']})}),e.jsx(de,{label:"Отправить",loading:b,disabled:b}),j&&e.jsx("div",{style:{color:"#e44444",marginTop:"0.5rem",fontWeight:"600",fontSize:"0.75rem"},children:j})]}),e.jsx(ue,{isOpen:z})]})};export{Te as default};

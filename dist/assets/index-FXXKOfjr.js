import{r as u,j as e,F as N,i as B,a as K,b as U}from"./index-Rd33IoH9.js";import{c as Y,u as G,a as J,b as Q,d as X,e as Z,F as ee,T as te,f as p,g,h as se,D as ae,i as re,S as ne,M as oe,t as ie}from"./constants-K0aoAq2B.js";import{AssentP as ce,Link as le}from"./index-enBX0C7q.js";const me=["contact_name","email","phone","date"],de=Y(me),fe=()=>{var b,D,T;const{control:m,formState:{errors:n},handleSubmit:w,reset:y,watch:d}=G({resolver:ie(de),mode:"onSubmit"}),{setDepartment:E,setDivision:v,setType:R,setDateRequest:k}=J(),{resetDateTime:A,time:h,startDate:i}=Q(),{filter:a,clearFilter:C}=X(),[V,f]=u.useState(!1),[S,o]=u.useState(""),q=d("contact_name"),z=d("email"),x=d("phone"),I=()=>!q||!z||!x?(o("Пожалуйста, заполните все обязательные поля."),!1):a!=null&&a.id?!h||!i?(o("Пожалуйста, выберите дату и время."),!1):!0:(o("Пожалуйста, выберите тип заявки."),!1);u.useEffect(()=>{if(a!=null&&a.id&&i){const t=new Date(i).toISOString().split("T")[0];E(11),v(6),R(a.id),k(t)}},[a,i]);const{isLoading:j,mutate:L}=Z({mutationKey:["createRequest"],mutationFn:async s=>await K.post(`${U}/api/requests/`,s,{headers:{"Content-Type":"application/json",Authorization:`${localStorage.getItem("authToken")}`}})}),O=s=>{if(!I())return;const[t,P]=h.split(":").map(Number),r=new Date(i);r.setHours(t,P,0,0);const W=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}T${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}:${String(r.getSeconds()).padStart(2,"0")}`,l={...s,department:11,division:6,type:a.id,date:W},c=x.replace(/\D/g,"");if(l.phone=c.startsWith("7")?"8"+c.slice(1):(c.startsWith("8"),c),l.phone.length<8||l.phone.length>14){o("Телефон должен содержать от 8 до 14 цифр.");return}L(l,{onSuccess:()=>{f(!0),setTimeout(()=>f(!1),3e3),A(),C(),y({contact_name:"",phone:"",email:"",date:""}),o("")},onError:H=>{var $,_,M;const F=(M=(_=($=H.response)==null?void 0:$.data)==null?void 0:_.non_field_errors)==null?void 0:M[0];o(F?`Произошла ошибка при отправке. ${F}`:"Произошла ошибка при отправке, попробуйте ещё раз.")}})};return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{submitFn:w(O),children:[e.jsx(te,{}),e.jsx(p,{field:"contact_name",error:((b=n.contact_name)==null?void 0:b.message)||"",control:m,render:({field:s})=>{var t;return e.jsx(g,{fieldValue:"contact_name",error:((t=n.contact_name)==null?void 0:t.message)||"",field:s})}}),e.jsxs(N,{$direction:B?"column":"row",$gap:15,$justify:"space-between",$align:"flex-start",children:[e.jsx(p,{field:"email",error:((D=n.email)==null?void 0:D.message)||"",control:m,render:({field:s})=>{var t;return e.jsx(g,{fieldValue:"email",error:((t=n.email)==null?void 0:t.message)||"",field:s})}}),e.jsx(p,{field:"phone",error:((T=n.phone)==null?void 0:T.message)||"",control:m,render:({field:s})=>{var t;return e.jsx(g,{fieldValue:"phone",error:((t=n.phone)==null?void 0:t.message)||"",field:s})}})]}),e.jsxs(se,{children:[e.jsx(ae,{}),e.jsx(re,{})]}),e.jsx(ce,{children:e.jsxs("label",{children:['Нажимая кнопку "Отправить", Вы даёте свое  ',e.jsx(le,{href:"/public/Согласие-на-обработку.pdf",target:"_blanck",children:"Согласие на обработку персональных данных"}),' в соответствии с Федеральным Законом №152-ФЗ от 27.07.2006 "О персональных данных".']})}),e.jsx(ne,{label:"Отправить",loading:j,disabled:j}),S&&e.jsx("div",{style:{color:"#e44444",marginTop:"0.5rem",fontWeight:"600",fontSize:"0.75rem"},children:S})]}),e.jsx(oe,{isOpen:V})]})};export{fe as default};

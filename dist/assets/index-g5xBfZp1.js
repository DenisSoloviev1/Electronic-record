import{r as u,j as e,F as B,i as w,a as K,b as U}from"./index-dJmx2XrE.js";import{c as Y,u as G,a as J,b as Q,d as X,e as Z,F as ee,T as te,f as p,g,h as se,D as ae,i as re,S as ne,M as oe,t as ie}from"./constants-G6jq7zq6.js";import{AssentP as ce,Link as le}from"./index-S6eT5IVJ.js";const me=["contact_name","email","phone","date"],de=Y(me),fe=()=>{var b,D,T;const{control:m,formState:{errors:n},handleSubmit:y,reset:E,watch:d}=G({resolver:ie(de),mode:"onSubmit"}),{setDepartment:v,setDivision:R,setType:k,setDateRequest:A}=J(),{resetDateTime:C,time:h,startDate:i}=Q(),{filter:a,clearFilter:V}=X(),[q,f]=u.useState(!1),[S,o]=u.useState(""),z=d("contact_name"),I=d("email"),x=d("phone"),L=()=>!z||!I||!x?(o("Пожалуйста, заполните все обязательные поля."),!1):a!=null&&a.id?!h||!i?(o("Пожалуйста, выберите дату и время."),!1):!0:(o("Пожалуйста, выберите тип заявки."),!1);u.useEffect(()=>{if(a!=null&&a.id&&i){const t=new Date(i).toISOString().split("T")[0];v(11),R(6),k(a.id),A(t)}},[a,i]);const{isLoading:j,mutate:O}=Z({mutationKey:["createRequest"],mutationFn:async s=>await K.post(`${U}/api/requests/`,s,{headers:{"Content-Type":"application/json",Authorization:`${localStorage.getItem("authToken")}`}})}),P=s=>{if(!L())return;const[t,W]=h.split(":").map(Number),r=new Date(i);r.setHours(t,W,0,0);const H=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}T${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}:${String(r.getSeconds()).padStart(2,"0")}`,l={...s,department:11,division:6,type:a.id,date:H},c=x.replace(/\D/g,"");if(l.phone=c.startsWith("7")?"8"+c.slice(1):(c.startsWith("8"),c),l.phone.length<8||l.phone.length>14){o("Телефон должен содержать от 8 до 14 цифр.");return}O(l,{onSuccess:()=>{f(!0),setTimeout(()=>f(!1),3e3),C(),V(),E({contact_name:"",phone:"",email:"",date:""}),o("")},onError:N=>{var $,_,M;const F=(M=(_=($=N.response)==null?void 0:$.data)==null?void 0:_.non_field_errors)==null?void 0:M[0];o(F?`Произошла ошибка при отправке. ${F}`:"Произошла ошибка при отправке, попробуйте ещё раз.")}})};return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{submitFn:y(P),children:[e.jsx(te,{}),e.jsx(p,{field:"contact_name",error:((b=n.contact_name)==null?void 0:b.message)||"",control:m,render:({field:s})=>{var t;return e.jsx(g,{fieldValue:"contact_name",error:((t=n.contact_name)==null?void 0:t.message)||"",field:s})}}),e.jsxs(B,{$direction:w?"column":"row",$gap:w?0:15,$justify:"space-between",$align:"flex-start",children:[e.jsx(p,{field:"email",error:((D=n.email)==null?void 0:D.message)||"",control:m,render:({field:s})=>{var t;return e.jsx(g,{fieldValue:"email",error:((t=n.email)==null?void 0:t.message)||"",field:s})}}),e.jsx(p,{field:"phone",error:((T=n.phone)==null?void 0:T.message)||"",control:m,render:({field:s})=>{var t;return e.jsx(g,{fieldValue:"phone",error:((t=n.phone)==null?void 0:t.message)||"",field:s})}})]}),e.jsxs(se,{children:[e.jsx(ae,{}),e.jsx(re,{})]}),e.jsx(ce,{children:e.jsxs("label",{children:['Нажимая кнопку "Отправить", Вы даёте свое  ',e.jsx(le,{href:"/public/Согласие-на-обработку.pdf",target:"_blanck",children:"Согласие на обработку персональных данных"}),' в соответствии с Федеральным Законом №152-ФЗ от 27.07.2006 "О персональных данных".']})}),e.jsx(ne,{label:"Отправить",loading:j,disabled:j}),S&&e.jsx("div",{style:{color:"#e44444",marginTop:"0.5rem",fontWeight:"600",fontSize:"0.75rem"},children:S})]}),e.jsx(oe,{isOpen:q})]})};export{fe as default};
